jobs:
  include:
    - language: php
      php:
        - 7.3
      services:
        - mysql
      cache:
        directories:
          - node_modules
          - vendor
      before_script:
        - cd ./tick-it-easy-backend
        - cp .env.travis .env
        - sudo mysql -e 'create database tick_it_easy;'
        - composer self-update
        - composer install --prefer-source --no-interaction --dev
        - php artisan key:generate
        - php artisan migrate
        - php artisan db:seed

      deploy:
        provider: heroku
        skip_cleanup: true
        api_key:
            secure: "wWR/0SnYYkgXrNcHrEzL7AadmAZzajSE+wCLmvvKzundRh1N1uXJEhcNnk903DSVnmSpgc8hb72JN7t+jTOu6ioIk7VQRbr7iqdtnbY+f9E/x6/hxf9OZneG7z05m6o4YljnbQqg1H86Is8ANk7+17nDiDCnp3xiYuAZXNSl/RilOGRz9Jem2d1AsOj8hYlyjA6bbgaulZ6CtDQSZUMHRBlg2LGQ7713HQm/gnniiqv6MFj1dzalul0shBU4IHIrlVRFPnErwurHvncvYIaTpwcCap6IQf2PF3a5b33Gn1dH/l6gXPXAXtTcezRiCg30exF1Qe7Qw6a7GPWyQBSGo4LpOooRTzewn8lqAd76lyMc7fVa5CI+7wMDVetQuaodaEPhXDrFxsBkdCBmUf8yqDSvEo8w2sFJjW/MLRzBLOgrA2FMFzCbcbij//ETRtc5jhctxqODuUGSB/bm2AJ0U78MLau9YorCJg3CczvjOlTmn7LtLgXLkFxN7MgieQP38ECVlfma7QKzboE7dQ0UAnwUg3/VwPp21PFM/TjGU3XJsopbEIRqCIJBifwhwBtAT5mW0Q1mfpWTRUvqV3ezEk8j2IHJeE8u41wPG7d6tTOhgImVIq2WFFIdyf4N0c79FhOhi9vOHnR5suIMUqtX+bAVgm9PirTC8KzQ56g/J7g="
        app: tick-it-easy-backend
        on:
          branch: main

    - language: node_js
      node_js:
        - '12'

      addons:
        apt:
          sources:
            - google-chrome
          packages:
            - google-chrome-stable

      cache:
        directories:
          - ./node_modules
      before_script:
        - cd frontend
        - npm install
        - npm run build
      script:
        - npm run test -- --watch=false --no-progress --browsers=ChromeHeadlessNoSandbox
         
      deploy:
        provider: heroku
        skip_cleanup: true
        api_key:
            secure: "wWR/0SnYYkgXrNcHrEzL7AadmAZzajSE+wCLmvvKzundRh1N1uXJEhcNnk903DSVnmSpgc8hb72JN7t+jTOu6ioIk7VQRbr7iqdtnbY+f9E/x6/hxf9OZneG7z05m6o4YljnbQqg1H86Is8ANk7+17nDiDCnp3xiYuAZXNSl/RilOGRz9Jem2d1AsOj8hYlyjA6bbgaulZ6CtDQSZUMHRBlg2LGQ7713HQm/gnniiqv6MFj1dzalul0shBU4IHIrlVRFPnErwurHvncvYIaTpwcCap6IQf2PF3a5b33Gn1dH/l6gXPXAXtTcezRiCg30exF1Qe7Qw6a7GPWyQBSGo4LpOooRTzewn8lqAd76lyMc7fVa5CI+7wMDVetQuaodaEPhXDrFxsBkdCBmUf8yqDSvEo8w2sFJjW/MLRzBLOgrA2FMFzCbcbij//ETRtc5jhctxqODuUGSB/bm2AJ0U78MLau9YorCJg3CczvjOlTmn7LtLgXLkFxN7MgieQP38ECVlfma7QKzboE7dQ0UAnwUg3/VwPp21PFM/TjGU3XJsopbEIRqCIJBifwhwBtAT5mW0Q1mfpWTRUvqV3ezEk8j2IHJeE8u41wPG7d6tTOhgImVIq2WFFIdyf4N0c79FhOhi9vOHnR5suIMUqtX+bAVgm9PirTC8KzQ56g/J7g="
        app: tick-it-easy-frontend
        on:
          branch: main
