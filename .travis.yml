jobs:
  include:
    - language: php
      php:
        - 7.3
      services:
        - mysql
      cache:
        directories:
          - node_modules
          - vendor
      before_script:
        - cd ./tick-it-easy-backend
        - cp .env.travis .env
        - sudo mysql -e 'create database tick_it_easy;'
        - composer self-update
        - composer install --prefer-source --no-interaction --dev
        - php artisan key:generate
        - php artisan migrate
        - php artisan db:seed

      deploy:
        provider: heroku
        skip_cleanup: true
        api_key:
            secure: "bUhrCe8OXnQBMXlvjvJZXINoQy295KA4CpXfy/QrcGLHooZO7WHNhXx7kxyFSUYUQJxTf1o2+sMhhhv1ln7OFWVhWeRx66gJlR43ai+q94I7MVBNmPTjBiEwx7kMUDXeBS1UrANuZxf+aV6DFHlP7gICAJDLsBDc1c2wVLpIzYeYYOqJ+ZUjVmcyXG6xkfsosOCGOoXR4mRHTLE55Wmf74Irv41mxu8VZ2LNuLSOGNfqhbQZwZKaV4i538D4c7EnAdIouSsFccfX4T5gvACnYbVbemmDkJIyWCLnwmb1M/fGa4VHLZ8UO4YovxkH9WOzzGYslsJ5d4O8el0vRhFmlgcCflmTJSlSKFI26RLt/dAV3k96lk7cJYoZYjHmzTcdTSYvK3k9xL3zJT2bkngbJ/HjeoEvbg3BgZg5rBjlAJMU6SOAF5rf3dq6iVM3XdxDjZ6IdchtAO+AjBBt2rTLurAHo4nktfJf+8tGtLtbs07/83NhfxYTCJeNPsJMtOvWVW8rbCmAao0gprr00kzbI/YaEA9FQo/1osEMoB+kjZbcCD/gQz96MSNuAgungeQHiwAFuR1jg7MXB050m/9FoiyGnwpZ4d8wDiQumX3ET+X5NeBFYb905k+AYrVSHMKPYPIdLTpPxTUBjRLydLViZ88WFWY/wl3T0CyT76lFWow="
        app: tick-it-easy-backend
        on:
          branch: main

    - language: node_js
      node_js:
        - '12'

      addons:
        apt:
          sources:
            - google-chrome
          packages:
            - google-chrome-stable

      cache:
        directories:
          - ./node_modules
      before_script:
        - cd frontend
        - npm install
        - npm run build
      script:
        - npm run test -- --watch=false --no-progress --browsers=ChromeHeadlessNoSandbox
         
      deploy:
        provider: heroku
        skip_cleanup: true
        api_key:
            secure: "bUhrCe8OXnQBMXlvjvJZXINoQy295KA4CpXfy/QrcGLHooZO7WHNhXx7kxyFSUYUQJxTf1o2+sMhhhv1ln7OFWVhWeRx66gJlR43ai+q94I7MVBNmPTjBiEwx7kMUDXeBS1UrANuZxf+aV6DFHlP7gICAJDLsBDc1c2wVLpIzYeYYOqJ+ZUjVmcyXG6xkfsosOCGOoXR4mRHTLE55Wmf74Irv41mxu8VZ2LNuLSOGNfqhbQZwZKaV4i538D4c7EnAdIouSsFccfX4T5gvACnYbVbemmDkJIyWCLnwmb1M/fGa4VHLZ8UO4YovxkH9WOzzGYslsJ5d4O8el0vRhFmlgcCflmTJSlSKFI26RLt/dAV3k96lk7cJYoZYjHmzTcdTSYvK3k9xL3zJT2bkngbJ/HjeoEvbg3BgZg5rBjlAJMU6SOAF5rf3dq6iVM3XdxDjZ6IdchtAO+AjBBt2rTLurAHo4nktfJf+8tGtLtbs07/83NhfxYTCJeNPsJMtOvWVW8rbCmAao0gprr00kzbI/YaEA9FQo/1osEMoB+kjZbcCD/gQz96MSNuAgungeQHiwAFuR1jg7MXB050m/9FoiyGnwpZ4d8wDiQumX3ET+X5NeBFYb905k+AYrVSHMKPYPIdLTpPxTUBjRLydLViZ88WFWY/wl3T0CyT76lFWow="
        app: tick-it-easy-frontend
        on:
          branch: main
